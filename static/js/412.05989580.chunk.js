"use strict";(self.webpackChunkmy_react_appo=self.webpackChunkmy_react_appo||[]).push([[412],{9412:(e,o,t)=>{t.r(o),t.d(o,{default:()=>P});var a=t(9950),l=t(3464),n=t(33),r=t(8170),s=t(5308),i=t(9739),c=t(226),d=t(4857),u=t(6589),m=t(6491),g=t(6639),p=t(2053),x=t(5277),h=t(5333),y=t(899),A=t(975),j=t(7324),v=t(9694),f=t(9532),C=t(2578),S=t(9751),b=(t(6820),t(3849)),w=t(294),E=t(8429),k=t(2845),R=t(2675),D=t(4414);const I=e=>{let{isOpen:o,onClose:t,onConfirm:d}=e;const[u,m]=(0,a.useState)("");return(0,D.jsxs)(l.A,{open:o,onClose:t,children:[(0,D.jsx)(n.A,{children:"Introduzca Descuento"}),(0,D.jsx)(r.A,{children:(0,D.jsx)(s.A,{autoFocus:!0,margin:"dense",label:"Descuento en %",type:"number",fullWidth:!0,value:u,onChange:e=>m(e.target.value)})}),(0,D.jsxs)(i.A,{children:[(0,D.jsx)(c.A,{onClick:t,children:"Cancel"}),(0,D.jsx)(c.A,{onClick:()=>{u<90?d(u):alert("Ha ocurido un error"),t()},color:"primary",children:"Confirm"})]})]})},P=()=>{const[e,o]=(0,a.useState)(""),[t,l]=(0,a.useState)(""),[n,r]=(0,a.useState)(""),[i,P]=(0,a.useState)(""),[T,H]=(0,a.useState)(null),[G,N]=(0,a.useState)(""),[F,U]=(0,a.useState)(!1),[W,J]=(0,a.useState)(""),[K,O]=(0,a.useState)(!1),[q,B]=(0,a.useState)(""),[z,L]=(0,a.useState)([]),[_,Z]=(0,a.useState)("Aerea"),[M,X]=(0,a.useState)([]),[Y,Q]=(0,a.useState)(!0),[V,$]=(0,a.useState)([]),[ee,oe]=(0,a.useState)([]),[te,ae]=(0,a.useState)([]),[le,ne]=(0,a.useState)([]),[re,se]=(0,a.useState)({}),[ie,ce]=(0,a.useState)(""),[de,ue]=(0,a.useState)(""),[me,ge]=(0,a.useState)(""),pe=(0,C.C3)(w.A),xe=(0,d.A)(),he=(0,u.A)(xe.breakpoints.down("sm")),{codigo:ye,contexto:Ae}=(0,E.g)(),[je,ve]=(0,a.useState)(!1),[fe,Ce]=(0,a.useState)(!1),[Se,be]=(0,a.useState)(!1),[we,Ee]=(0,a.useState)(""),[ke,Re]=(0,a.useState)(!1),[De,Ie]=(0,a.useState)("color"),[Pe,Te]=(0,a.useState)(null),[He,Ge]=(0,a.useState)(""),[Ne,Fe]=(0,a.useState)(""),Ue=(0,E.Zp)(),We=(0,b.aU)(w.A),Je=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var t,a,l;(Ie(e),Te(o),o)?(console.log(o.precio,"hoal"),"talla"===e?(Ge(null!==(t=o.label)&&void 0!==t?t:""),Fe(null!==(a=o.precio)&&void 0!==a?a:0)):(Ge(null!==(l=o.label)&&void 0!==l?l:""),Fe(""))):(Ge(""),Fe(""));Re(!0)},Ke=e=>e<=7e3?e>0?1.3*e+1500:0:e<=25e3?1.22*e+1e3:e<=25e4?1.15*e:e<=5e5?1.12*e:1.08*e+1e5;console.log(ye);const[Oe,qe]=(0,a.useState)(null),Be=()=>{Ce(!1)},ze=async e=>{let o=parseInt(e),t="Guinea Ecuatorial"===T.Pais?"Nacional":"Exterior";const a=(0,C.KR)(pe,"GE/".concat(t,"/Prod/").concat(ye));try{if(console.log(e,"existe"),await(0,C.yo)(a,{Descuento:o}),o>0){(0,C.KR)(pe,"GE/Rebajas/".concat(ye));const e=(0,C.KR)(pe,"GE/Filtros/".concat(t,"/").concat(T.Categoria,"/").concat(ye));(0,C.KR)(pe,"GE/".concat(t,"/Prod/").concat(ye));await(0,C.yo)(e,{Descuento:o})}else{const e=(0,C.KR)(pe,"GE/Rebajas/".concat(ye)),a=(0,C.KR)(pe,"Filtros/".concat(t,"/").concat(T.Categoria,"/").concat(ye));await(0,C.yo)(a,{Descuento:o}),await(0,C.TF)(e)}console.log("Data updated successfully")}catch(l){console.error("Error updating data: ",l)}},Le=async(e,o)=>{Ce(!0),Ee(e),console.log(e,"a elimianr"),Ie(o)},_e=async e=>{const o=(0,b.aU)(w.A),t=(0,b.H9)(o,"productos",e),a=await(0,b.x7)(t);if(!a.exists())throw new Error("El producto no existe en Firestore.");return a.data()},Ze=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,S.c7)(w.A);for(const a of e)try{const e=a.startsWith("https")?Me(a):a,t=(0,S.KR)(o,e);await(0,S.XR)(t),console.log("\ud83d\uddd1 Imagen eliminada: ".concat(e))}catch(t){console.warn("No se pudo eliminar la imagen ".concat(a,":"),t)}},Me=e=>{try{const o=e.split("?")[0].split("/o/")[1];return decodeURIComponent(o)}catch{return null}};(0,a.useEffect)((()=>((async e=>{try{var t,a,n,r,s;const i=(0,b.H9)(We,"productos",e),c=await(0,b.x7)(i);if(!c.exists())return console.log("\u274c No existe el documento del producto:",e),H(null),ae([]),void $([]);const d=c.data();H(d),o(null!==(t=d.Titulo)&&void 0!==t?t:""),J(null!==(a=d.Ubicacion)&&void 0!==a?a:""),l(null!==(n=d.Precio)&&void 0!==n?n:""),B(null!==(r=d.Detalles)&&void 0!==r?r:""),U(null!==(s=d.Stock)&&void 0!==s?s:""),console.log("Producto Data:",d);const u=(0,b.rJ)(We,"productos",e,"colores"),m=(0,b.rJ)(We,"productos",e,"tallas"),[g,p]=await Promise.all([(0,b.GG)(u),(0,b.GG)(m)]),x=g.docs.map((e=>e.data())),h=p.docs.map((e=>e.data()));console.log("Colores:",x),$(x||[]),ae(h||[])}catch(i){console.error("\u274c Error al obtener datos:",i)}})(ye),()=>{})),[]);return(0,D.jsxs)(D.Fragment,{children:[K&&(0,D.jsx)(m.A,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",bgcolor:"rgba(0,0,0,0.4)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,D.jsx)(g.A,{size:60,color:"primary"})}),(0,D.jsxs)(m.A,{component:"form",onSubmit:async o=>{o.preventDefault(),O(!0);const a={Titulo:e,Precio:parseInt(Ke(t)),Detalles:q},l=(0,b.H9)(We,"productos",ye);try{await(0,b.mZ)(l,a),alert("Producto modificado correctamente!"),O(!1),console.log("Producto actualizado correctamente.")}catch(n){O(!1),alert("ERROR INESPERADO: "+n.message),console.error("Error al actualizar el producto:",n)}},sx:{mt:2,padding:2},children:[(0,D.jsx)(k.A,{texto:"Editar"}),(0,D.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",marginTop:he?40:0},children:[(0,D.jsx)(c.A,{variant:"contained",color:"error",onClick:async()=>{if((e=>e?(console.log(e,"wettin"),window.confirm("\xbfSeguro que quieres eliminar este producto y todas sus im\xe1genes?")):(alert("C\xf3digo del producto no v\xe1lido."),!1))(ye)){O(!0);try{const e=(await _e(ye)).Imagenes||[];await Ze(e),await(async e=>{const o=(0,b.aU)(w.A),t=(0,b.H9)(o,"productos",e);await(0,b.kd)(t),console.log("\u2705 Documento eliminado de Firestore")})(ye),alert("\u2705 Producto y sus im\xe1genes eliminados correctamente."),Ue("/")}catch(e){console.error("\u274c Error al eliminar:",e),alert("Error eliminando el producto: "+e.message)}finally{O(!1)}}},children:"ELIMINAR PRODUCTO"}),(0,D.jsx)(c.A,{variant:"contained",color:"info",onClick:()=>{ve(!0)},children:"APLICAR DESCUENTO"})]}),(0,D.jsxs)("div",{style:{margin:10},children:[(0,D.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:"Colores"}),V.map(((e,o)=>(0,D.jsx)(x.A,{label:e.label,style:{margin:3},onClick:()=>Je("color",e),onDelete:()=>Le(e,"color")},o))),(0,D.jsx)(h.A,{color:"primary",onClick:()=>Je("color"),children:(0,D.jsx)(f.A,{})})]}),(0,D.jsxs)("div",{style:{margin:10},children:[(0,D.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:"Tallas"}),te.map(((e,o)=>(0,D.jsx)(x.A,{label:"".concat(e.label," : ").concat(e.precio),style:{margin:3},onClick:()=>Je("talla",e),onDelete:()=>Le(e,"talla")}))),(0,D.jsx)(h.A,{color:"primary",onClick:()=>Je("talla"),children:(0,D.jsx)(f.A,{})})]}),(0,D.jsxs)(y.Ay,{container:!0,spacing:2,marginTop:he?5:0,children:[(0,D.jsx)(y.Ay,{item:!0,xs:12,children:(0,D.jsx)(s.A,{label:"Title",variant:"outlined",value:e,onChange:e=>o(e.target.value),required:!0,fullWidth:!0})}),(0,D.jsx)(y.Ay,{item:!0,xs:12,children:(0,D.jsx)(s.A,{label:"Price",variant:"outlined",type:"number",value:t,onChange:e=>l(e.target.value),required:!0,fullWidth:!0})}),"Nacional"===Ae&&(0,D.jsxs)(m.A,{display:"flex",alignItems:"flex-end",marginY:1,margin:1,children:[(0,D.jsx)(s.A,{label:"Cantidad",type:"number",value:G,onChange:e=>N(e.target.value),style:{marginLeft:"8px"}}),(0,D.jsx)("div",{style:{margin:10,marginLeft:30},children:(0,D.jsx)(A.A,{control:(0,D.jsx)(j.A,{checked:F,onChange:e=>{U(e.target.checked)}}),label:"Stock"})})]}),(0,D.jsx)(y.Ay,{item:!0,xs:12,children:(0,D.jsx)(s.A,{label:"Details",variant:"outlined",multiline:!0,rows:4,value:q,onChange:e=>B(e.target.value),required:!0,fullWidth:!0})}),(0,D.jsx)("div",{style:{display:"flex",alignContent:"center",alignItems:"center"},children:(0,D.jsx)(c.A,{type:"submit",variant:"contained",color:"primary",children:"PUBLICAR"})})]}),Oe&&(0,D.jsxs)("p",{children:["Entered number: ",Oe]}),(0,D.jsx)(I,{isOpen:je,onClose:()=>{ve(!1)},onConfirm:e=>{qe(e),ze(e)}}),(0,D.jsx)(R.A,{open:fe,message:"Seguro que desea borrar este valor?",onClose:Be,onConfirm:async()=>{try{const e="color"===De,o=e?"colores":"tallas";if(console.log(we,De),e?$((e=>e.filter((e=>e.id!==we.id)))):ae((e=>e.filter((e=>e.id!==we.id)))),console.log(we.id,"eliminar"),!we.id)return;const t=(0,b.H9)(We,"productos",ye),a=(0,b.H9)((0,b.rJ)(t,o),we.id);await(0,b.kd)(a),console.log("\u2705 ".concat(e?"Color":"Talla"," '").concat(we.label,"' eliminado de Firestore."))}catch(e){console.error("\u274c Error eliminando chip:",e)}Be()}}),(0,D.jsx)(v.Ay,{anchor:"right",open:ke,onClose:()=>Re(!1),children:(0,D.jsxs)(m.A,{sx:{width:300,padding:2},children:[(0,D.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"color"===De?"Nuevo Color":"Nueva Talla"}),(0,D.jsx)(s.A,{label:"color"===De?"Color":"Talla",value:He,onChange:e=>Ge(e.target.value),fullWidth:!0,margin:"normal"}),"talla"===De&&(0,D.jsx)(s.A,{label:"Precio",type:"number",value:Ne,onChange:e=>Fe(e.target.value),fullWidth:!0,margin:"normal"}),(0,D.jsx)(c.A,{variant:"contained",color:"primary",onClick:async()=>{if(!He)return;const e=(0,b.H9)(We,"productos",ye);if("color"===De)if(Pe){$((e=>e.map((e=>e.id===Pe.id?{...e,label:He}:e))));const o=(0,b.H9)((0,b.rJ)(e,"colores"),Pe.id);await(0,b.mZ)(o,{label:He}),console.log("Color editado:",He)}else{const o=(0,b.H9)((0,b.rJ)(e,"colores")),t={id:o.id,label:He};await(0,b.BN)(o,t),$((e=>[...e,t])),console.log("Color nuevo guardado:",t)}else{let o=parseInt(Ke(Ne));const t={label:He,precio:o||0};if(Pe){ae((e=>e.map((e=>e.id===Pe.id?{...e,label:He,precio:o}:e))));(0,b.H9)((0,b.rJ)(e,"tallas"),Pe.id);console.log("Talla editada:",t)}else{const o=(0,b.H9)((0,b.rJ)(e,"tallas")),a={id:o.id,...t};await(0,b.BN)(o,a),ae((e=>[...e,a])),console.log("Talla nueva guardada:",a)}}Te(null),$([]),ae([]),Ge(""),Fe(""),Ce(!1),Re(!1)},sx:{mt:2},fullWidth:!0,children:"Guardar"})]})})]})]})}}}]);